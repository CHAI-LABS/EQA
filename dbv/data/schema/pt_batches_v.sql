CREATE ALGORITHM=UNDEFINED DEFINER=`homestead`@`%` SQL SECURITY DEFINER VIEW `pt_batches_v` AS select `pb`.`id` AS `id`,`pb`.`uuid` AS `uuid`,`pb`.`batch_name` AS `batch_name`,`pb`.`pt_round_id` AS `pt_round_id`,count(`ppt`.`id`) AS `assigned`,sum((case when (`ppt`.`received` = 0) then 1 else 0 end)) AS `not_received`,sum((case when (`ppt`.`received` = 1) then 1 else 0 end)) AS `received` from (`eqa`.`pt_batches` `pb` left join (select `eqa`.`pt_panel_tracking`.`id` AS `id`,`eqa`.`pt_panel_tracking`.`pt_batch_id` AS `pt_batch_id`,(case when (isnull(`eqa`.`pt_panel_tracking`.`participant_received_date`) and (`eqa`.`pt_panel_tracking`.`courier_collection_date` is not null)) then 0 else 1 end) AS `received` from `eqa`.`pt_panel_tracking`) `ppt` on((`ppt`.`pt_batch_id` = `pb`.`id`))) group by `pb`.`id`